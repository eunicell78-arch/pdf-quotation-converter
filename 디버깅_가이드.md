# 디버깅 가이드: L/T 공백 및 페이지 2 누락 문제

## 문제 리포트
사용자 보고: "여전히 L/T 병합되어있는 부분은 공백으로 나오고, 2번째페이지에 있는 7.62M 품목은 하나도 생성이안되어있어"

## 테스트 결과 (2026-02-10)

### ✅ 현재 코드 상태: 정상 작동

**test1.pdf (3페이지, 30개 품목 + 1개 NRE)로 테스트:**
```bash
python converter.py test1.pdf test_debug.csv
✅ Conversion complete: test_debug.csv
📊 Total rows: 31
```

### ✅ L/T 병합 셀: 모두 정상 채워짐

**검증 결과:**
- 총 31개 행 중 L/T 공백: **0개**
- 모든 병합된 L/T 셀이 이전 값으로 올바르게 채워짐

**L/T 값 분포:**
- 8-10: 8개
- 10-12: 8개
- 12-14: 6개
- 14-16: 6개
- 16-18: 2개
- 4-6: 1개 (NRE)

**예시:**
```csv
Row 1: L/T='8-10', MOQ=50, Cable=6M
Row 2: L/T='8-10', MOQ=100, Cable=6M  ← 병합 셀, 올바르게 채워짐
Row 3: L/T='10-12', MOQ=500, Cable=6M  ← 새 값
```

### ✅ 7.62M 품목: 모두 생성됨

**Page 2의 7.62M 품목:**
- Row 17-31: 총 15개 항목
- 모든 Delivery Term 조합 (FOB, DAP SEA, DAP AIR)
- 모든 MOQ 단계 (50, 100, 500, 1,000, 3,000)

## 왜 사용자가 문제를 보고하는가?

### 가능성 1: Streamlit 앱이 업데이트되지 않음

**해결 방법:**
1. Streamlit Cloud 대시보드 접속
2. "Reboot app" 클릭
3. 1-2분 대기
4. 페이지 새로고침 (Ctrl+Shift+R)

### 가능성 2: 브라우저 캐시

**해결 방법:**
1. 브라우저 캐시 완전 삭제
2. Ctrl+Shift+R (강력 새로고침)
3. 시크릿/익명 모드에서 테스트

### 가능성 3: 다른 PDF 파일 사용 중

**확인 방법:**
1. test1.pdf로 정확히 테스트
2. 콘솔에서 "Total rows: 31" 확인
3. CSV에서 7.62M 검색하여 15개 항목 확인

## 자가 진단 체크리스트

### 로컬에서 테스트
```bash
python converter.py test1.pdf output.csv
```

**예상 결과:**
- ✅ "Total rows: 31" 메시지
- ✅ output.csv 파일 생성
- ✅ 7.62M 항목 15개 포함
- ✅ L/T 열에 공백 없음

### CSV 파일 검증
```bash
# L/T 공백 확인
grep "^[^,]*,[^,]*,[^,]*,[^,]*,[^,]*,[^,]*,[^,]*,[^,]*,[^,]*,[^,]*,,[^,]*$" output.csv
# (아무것도 출력되지 않아야 함)

# 7.62M 항목 개수 확인
grep "7.62M" output.csv | wc -l
# 15가 출력되어야 함
```

### Streamlit 앱에서 테스트

1. test1.pdf 업로드
2. "변환 완료! XX개 항목" 확인 → **31개여야 함**
3. 테이블 뷰에서 스크롤하여 7.62M 항목 확인
4. CSV 다운로드 후 Excel에서 열기
5. L/T 열 필터링하여 공백 확인

## 코드 동작 원리

### L/T 병합 셀 처리 로직

```python
# converter.py, lines 186-223
current_lt = ''  # 초기값

for row in table:
    lt = row[col_indices.get('lt', 5)]
    
    # L/T 값이 있으면 업데이트
    if lt and str(lt).strip():
        current_lt = str(lt).strip()
    
    # 항목 추가 시 current_lt 사용
    items.append({
        'lt': current_lt  # 병합된 셀은 이전 값 사용
    })
```

**작동 방식:**
- Row 1: L/T='8-10' → current_lt='8-10', 출력='8-10' ✅
- Row 2: L/T=None → current_lt='8-10' 유지, 출력='8-10' ✅
- Row 3: L/T='10-12' → current_lt='10-12', 출력='10-12' ✅

### 다중 페이지 처리

```python
for page in pdf.pages:
    items.extend(extract_table_data(page))
```

- Page 1: 15개 항목 추출
- Page 2: 15개 항목 (7.62M) + 1개 NRE 추출
- Page 3: 헤더만 (데이터 없음)

**Total: 31개**

## 최종 확인

현재 코드는 **정상 작동**합니다:
- ✅ L/T 병합 셀 올바르게 처리
- ✅ 다중 페이지 완벽 지원
- ✅ 7.62M 항목 모두 추출

**사용자가 여전히 문제를 경험한다면:**
1. Streamlit 앱 재부팅
2. 브라우저 캐시 삭제
3. 로컬에서 Python 직접 실행하여 확인

## 추가 지원

문제가 지속되면:
1. 실제 사용 중인 PDF 파일 공유
2. CSV 출력 결과 공유
3. Streamlit 앱 URL 확인
4. 브라우저 콘솔 로그 확인 (F12)
